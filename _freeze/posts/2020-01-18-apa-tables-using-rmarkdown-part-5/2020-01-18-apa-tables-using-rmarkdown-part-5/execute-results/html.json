{
  "hash": "6805a746cb7da786e7efdda41a2c41ff",
  "result": {
    "markdown": "---\ntitle: 'APA Tables using RMarkdown: Part 5'\nauthor: Andy\ndate: '2020-01-18'\ncategories:\n  - Markdown\n  - R\n  - Writing\n---\n\n\n\nThis is the fifth part of a short blog series I am writing to re-create some of the sample tables found in the 7th edition *APA Publication Manual*. In this post I will attempt to show how to create a table to present the results of several fitted models. (This type of table is not among the example tables in the 7th edition *APA Publication Manual*.) To do so, I will incorporate many ideas that I covered in the [first](https://www.datadreaming.org/post/apa-tables-using-rmarkdown/), [second](https://www.datadreaming.org/post/apa-tables-using-rmarkdown-part-2/), [third](https://www.datadreaming.org/post/apa-tables-using-rmarkdown-part-3/) and [fourth](https://www.datadreaming.org/post/apa-tables-using-rmarkdown-part-4/) of these posts. \n\n\n# My Process\n\nI will again render to PDF and set up the YAML to import the **caption** package (LaTeX) and set up the APA caption formatting.\n\n\n::: {.cell}\n\n```{.yaml .cell-code}\n---\ntitle: \"Untitled\"\nauthor: \"Andrew Zieffler\"\ndate: \"1/12/2020\"\noutput: pdf_document\nheader-includes:\n   - \\usepackage{caption}\n   - \\captionsetup[table]{textfont={it}, labelfont={bf}, singlelinecheck=false, labelsep=newline}\n---\n```\n:::\n\n\n\nIn the RMarkdown body, I will load a few packages and also import a data set that I will use to fit the models.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load libraries\nlibrary(broom)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(tidyverse)\n\n# Import data\nmn = read_csv(\"https://raw.githubusercontent.com/zief0002/rustic-penguin/main/data/mn-schools.csv\") |>\n  mutate(public = if_else(sector == \"Public\", 1, 0))\n\n# View data\nhead(mn)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 Ã— 6\n  name                               grad sector    sat tuition public\n  <chr>                             <dbl> <chr>   <dbl>   <dbl>  <dbl>\n1 Augsburg College                   65.2 Private  1030    39.3      0\n2 Bethany Lutheran College           52.6 Private  1065    30.5      0\n3 Bethel University, Saint Paul, MN  73.3 Private  1145    39.4      0\n4 Carleton College                   92.6 Private  1400    54.3      0\n5 College of Saint Benedict          81.1 Private  1185    43.2      0\n6 Concordia College at Moorhead      69.4 Private  1145    36.6      0\n```\n:::\n:::\n\n\nThe data in were collected from http://www.collegeresults.org and contain 2011 institutional data for n=33 Minnesota colleges and universities. The codebook is available [here](http://zief0002.github.io/rustic-penguin/codebooks/mn-schools.html).\n\nWe need to compute the regression results from fitting an OLS model. Here I will predict variation in graduation rates using several potential competing models.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit models\nlm.1 = lm(grad ~ 1 + public + sat + tuition, data = mn)\nlm.2 = lm(grad ~ 1 + public + sat + tuition + public:sat, data = mn)\nlm.3 = lm(grad ~ 1 + public + sat + tuition + public:tuition, data = mn)\n```\n:::\n\n\n\nThere are several packages that can be used to present the results of one or more fitted models. These include [stargazer](https://cran.r-project.org/web/packages/stargazer/vignettes/stargazer.pdf), [texreg](https://github.com/leifeld/texreg), and [modelsummary](https://github.com/vincentarelbundock/modelsummary) among others. In this post I will focus on using the **stargazer** package, which I have found works well for fixed-effects models.\n\nAfter loading the **stagazer** package, the `stargazer()` function can be used to create a basic table of regression results. The `type=` argument defaults to `latex`, so if you are rendering to an HTML document, you need to change this to `type=\"html\"`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load library\nlibrary(stargazer)\n\n# Output model results in a table\nstargazer(lm.1, lm.2, lm.3, type = \"latex\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n% Table created by stargazer v.5.2.3 by Marek Hlavac, Social Policy Institute. E-mail: marek.hlavac at gmail.com\n% Date and time: Tue, Oct 31, 2023 - 18:00:09\n\\begin{table}[!htbp] \\centering \n  \\caption{} \n  \\label{} \n\\begin{tabular}{@{\\extracolsep{5pt}}lccc} \n\\\\[-1.8ex]\\hline \n\\hline \\\\[-1.8ex] \n & \\multicolumn{3}{c}{\\textit{Dependent variable:}} \\\\ \n\\cline{2-4} \n\\\\[-1.8ex] & \\multicolumn{3}{c}{grad} \\\\ \n\\\\[-1.8ex] & (1) & (2) & (3)\\\\ \n\\hline \\\\[-1.8ex] \n public & $-$0.647 & 9.132 & 8.554 \\\\ \n  & (4.716) & (32.466) & (19.945) \\\\ \n  & & & \\\\ \n sat & 0.104$^{***}$ & 0.106$^{***}$ & 0.106$^{***}$ \\\\ \n  & (0.016) & (0.018) & (0.017) \\\\ \n  & & & \\\\ \n tuition & 0.470$^{*}$ & 0.451$^{*}$ & 0.455$^{*}$ \\\\ \n  & (0.242) & (0.253) & (0.247) \\\\ \n  & & & \\\\ \n public:sat &  & $-$0.009 &  \\\\ \n  &  & (0.031) &  \\\\ \n  & & & \\\\ \n public:tuition &  &  & $-$0.487 \\\\ \n  &  &  & (1.025) \\\\ \n  & & & \\\\ \n Constant & $-$68.297$^{***}$ & $-$70.205$^{***}$ & $-$70.578$^{***}$ \\\\ \n  & (12.564) & (14.220) & (13.610) \\\\ \n  & & & \\\\ \n\\hline \\\\[-1.8ex] \nObservations & 33 & 33 & 33 \\\\ \nR$^{2}$ & 0.861 & 0.861 & 0.862 \\\\ \nAdjusted R$^{2}$ & 0.846 & 0.841 & 0.842 \\\\ \nResidual Std. Error & 6.562 (df = 29) & 6.667 (df = 28) & 6.651 (df = 28) \\\\ \nF Statistic & 59.732$^{***}$ (df = 3; 29) & 43.421$^{***}$ (df = 4; 28) & 43.660$^{***}$ (df = 4; 28) \\\\ \n\\hline \n\\hline \\\\[-1.8ex] \n\\textit{Note:}  & \\multicolumn{3}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\\\ \n\\end{tabular} \n\\end{table} \n```\n:::\n:::\n\n\nThe function outputs raw LaTeX (or HTML), so to get it to form into a table you need to include `results='asis'` in your Rmarkdown chunk.\n\n````\n```{r message=FALSE, results='asis'} \n# Load library\nlibrary(stargazer)\n\n# Output model results in a table\nstargazer(lm.1, lm.2, lm.3, type = \"latex\")\n```\n````\n\n![](stargazer-tbl.png){width=100%}\n\n\n### Customizing the Stargazer Output\n\nThere are several arguments in the `stargazer()` function to customize the table.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstargazer(\n  lm.1, lm.2, lm.3,\n  type = \"latex\",\n  table.placement = \"H\",\n  title = \"Three Regression Models Predicting Variation in Six-Year Graduation Rates\",\n  column.labels = c(\"Model A\", \"Model B\", \"Model C\"),\n  colnames = FALSE,\n  model.numbers = FALSE,\n  dep.var.caption = \" \",\n  dep.var.labels = \"Graduation Rate\",\n  covariate.labels = c(\"Public$^a$\", \"Median SAT score\", \"Tuition\", \"Public$^a$ x Median SAT score\", \"Public$^a$ x Tuition\"),\n  star.cutoffs = NA,\n  keep.stat = c(\"rsq\", \"f\"),\n  notes = \"$^a$0 = Private institution and 1 = Public institution.\",\n  notes.align = \"l\"\n  )\n```\n:::\n\n\n![](tbl-2.png){width=100%}\n\n\nThis is close, but there are a few things I am not happy with. Namely,\n\n- The table should be aligned with the caption rather than centered.\n- The double lines produced at the top and bottom of the table.\n- The label for the dependent variable, \"Graduation Rate\", is redundant with the caption so could be omitted, as could the border produced above it.\n- The note is separated from the *Note:* text and uses a colon rather than a period in this text. It also has the text \"NA\" since we set the `star.cutoff=` argument (which omits the dreaded significance stars) to `NA`. \n\n\nTo fix these things we need to edit the LaTeX syntax that is produced by the `stargazer()` function. To do this, run the syntax in the console and then copy-and-paste the raw LaTeX into your RMarkdown document (outside of a code chunk). The LaTeX syntax from our table is:\n\n\n::: {.cell}\n\n```{.latex .cell-code}\n\\begin{table}[H] \\centering \n  \\caption{Three Regression Models Predicting Variation in Six-Year Graduation Rates} \n  \\label{} \n\\begin{tabular}{@{\\extracolsep{5pt}}lccc} \n\\\\[-1.8ex]\\hline \n\\hline \\\\[-1.8ex] \n & \\multicolumn{3}{c}{ } \\\\ \n\\cline{2-4} \n\\\\[-1.8ex] & \\multicolumn{3}{c}{Graduation Rate} \\\\ \n & Model A & Model B & Model C \\\\ \n\\hline \\\\[-1.8ex] \n Public$^a$ & $-$0.647 & 9.132 & 8.554 \\\\ \n  & (4.716) & (32.466) & (19.945) \\\\ \n  & & & \\\\ \n Median SAT score & 0.104 & 0.106 & 0.106 \\\\ \n  & (0.016) & (0.018) & (0.017) \\\\ \n  & & & \\\\ \n Tuition & 0.470 & 0.451 & 0.455 \\\\ \n  & (0.242) & (0.253) & (0.247) \\\\ \n  & & & \\\\ \n Public$^a$ x Median SAT score &  & $-$0.009 &  \\\\ \n  &  & (0.031) &  \\\\ \n  & & & \\\\ \n Public$^a$ x Tuition &  &  & $-$0.487 \\\\ \n  &  &  & (1.025) \\\\ \n  & & & \\\\ \n Constant & $-$68.297 & $-$70.205 & $-$70.578 \\\\ \n  & (12.564) & (14.220) & (13.610) \\\\ \n  & & & \\\\ \n\\hline \\\\[-1.8ex] \nR$^{2}$ & 0.861 & 0.861 & 0.862 \\\\ \nF Statistic & 59.732 (df = 3; 29) & 43.421 (df = 4; 28) & 43.660 (df = 4; 28) \\\\ \n\\hline \n\\hline \\\\[-1.8ex] \n\\textit{Note:}  & \\multicolumn{3}{l}{NA} \\\\ \n & \\multicolumn{3}{l}{$^a$0 = Private institution and 1 = Public institution.} \\\\ \n\\end{tabular} \n\\end{table}\n```\n:::\n\n\n\nThe `\\centering` synatax in the first line is what is causing the table itself to be centered. Delete this. The double lines at the top and bottom of the table are produced by the two consecutive `hline` commands. Remove one at the beginning and end of the table. In a similar way the syntax that corresponds to the \"Graduation Rate\" label and the `\\cline{2-4}` preceeding it can be omitted.\n\n\nChanging the table note is a little more complicated. The primary syntax for this is the following:\n\n\n::: {.cell}\n\n```{.latex .cell-code}\n\\textit{Note:}  & \\multicolumn{3}{l}{NA} \\\\ \n & \\multicolumn{3}{l}{$^a$0 = Private institution and 1 = Public institution.} \\\\ \n```\n:::\n\n\nIn the syntax that creates the LaTeX table, the ampersand (`&`) indicates a new column and the double slash (`\\\\`) indicates the end of the row. So the italicized text *Note:* is put in the first cell of the row and then the text \"NA\" is placed in the next cell of the same row. The `multicolumn{3}{l}{}` actually combines the last 3 columns into a single cell and aligns the text (which is placed in the third set of curly braces) to the left. To make this all line up better, we are going to replace the note syntax with the following:\n\n\n::: {.cell}\n\n```{.latex .cell-code}\n\\multicolumn{4}{l}{\\textit{Note.} $^a$0 = Private institution and 1 = Public institution.} \\\\ \n```\n:::\n\n\nThis will combine all four columns of the table into a single cell and will align the text to the left of this cell. The resulting table will fix our issues. This is the syntax that is remaining:\n\n```\n\\begin{table}[H] \n  \\caption{Three Regression Models Predicting Variation in Six-Year Graduation Rates} \n  \\label{} \n\\begin{tabular}{@{\\extracolsep{5pt}}lccc} \n\\\\[-1.8ex]\n\\hline \\\\[-1.8ex] \n & \\multicolumn{3}{c}{ } \\\\ \n & Model A & Model B & Model C \\\\ \n\\hline \\\\[-1.8ex] \n Public$^a$ & $-$0.647 & 9.132 & 8.554 \\\\ \n  & (4.716) & (32.466) & (19.945) \\\\ \n  & & & \\\\ \n Median SAT score & 0.104 & 0.106 & 0.106 \\\\ \n  & (0.016) & (0.018) & (0.017) \\\\ \n  & & & \\\\ \n Tuition & 0.470 & 0.451 & 0.455 \\\\ \n  & (0.242) & (0.253) & (0.247) \\\\ \n  & & & \\\\ \n Public$^a$ x Median SAT score &  & $-$0.009 &  \\\\ \n  &  & (0.031) &  \\\\ \n  & & & \\\\ \n Public$^a$ x Tuition &  &  & $-$0.487 \\\\ \n  &  &  & (1.025) \\\\ \n  & & & \\\\ \n Constant & $-$68.297 & $-$70.205 & $-$70.578 \\\\ \n  & (12.564) & (14.220) & (13.610) \\\\ \n  & & & \\\\ \n\\hline \\\\[-1.8ex] \nR$^{2}$ & 0.861 & 0.861 & 0.862 \\\\ \nF Statistic & 59.732 (df = 3; 29) & 43.421 (df = 4; 28) & 43.660 (df = 4; 28) \\\\ \n\\hline \\\\[-1.8ex] \n\\multicolumn{4}{l}{\\textit{Note.} $^a$0 = Private institution and 1 = Public institution.} \\\\ \n\\end{tabular} \n\\end{table}\n```\n\nThe resulting table looks like the following.\n\n![](/post/2020-01-18-apa-tables-using-rmarkdown-part-5_files/Screen Shot 2020-01-18 at 11.30.32 AM.png){width=100%}\n\n\n### Adding Additional Model-Level Statistics into the Table\n\nYou may also wish to add other model-level summaries into the table. For example, below I will compute and add the corrected AIC into the table. To do this, use the `add.lines=` argument in the `stargazer()` function. This argument takes a list that gives the contents of each cell in the added row. In our example this would be a list including the text to produce in the first cell and then a corrected AIC value for each respective model in the remaining three cells. I also omit the $F$-statistic in the `keep.stat=` argument.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load library\nlibrary(AICcmodavg)\n\n# Create table\nstargazer(\n  lm.1, lm.2, lm.3,\n  type = \"latex\",\n  table.placement = \"H\",\n  title = \"Three Regression Models Predicting Variation in Six-Year Graduation Rates\",\n  column.labels = c(\"Model A\", \"Model B\", \"Model C\"),\n  colnames = FALSE,\n  model.numbers = FALSE,\n  dep.var.caption = \" \",\n  dep.var.labels = \"Graduation Rate\",\n  covariate.labels = c(\"Public$^a$\", \"Median SAT score\", \"Tuition\", \"Public$^a$ x Median SAT score\", \"Public$^a$ x Tuition\"),\n  star.cutoffs = NA,\n  keep.stat = c(\"rsq\"),\n  notes = \"$^a$0 = Private institution and 1 = Public institution.\",\n  notes.align = \"l\",\n  add.lines = list(c(\"Corrected AIC\", round(AICc(lm.1), 1), round(AICc(lm.2), 1), round(AICc(lm.3), 1)))\n  )\n```\n:::\n\n\nAfter editing the LaTeX syntax to make the same changes as before, we get the following table:\n\n![](tbl-3.png){width=100%}\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}